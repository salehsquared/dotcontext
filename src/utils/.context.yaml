version: 1
last_updated: 2026-02-13T06:15:06.842Z
fingerprint: 2b109cff
scope: src/utils
summary: >
  The src/utils directory provides utility functions for managing configurations, environment variables, and displaying
  messages. It facilitates tasks such as loading configuration files, managing environment settings, processing items in
  parallel, and estimating tokens in directory structures.
maintenance: |-
  If you modify files in this directory, update this .context.yaml to reflect
  your changes. Update the summary, and any decisions or constraints that changed.
  Do NOT update the fingerprint manually â€” run `context rehash` or it will be
  updated automatically on the next `context status` check.
  If you only read files in this directory, do not modify this file.
  Do not include secrets, API keys, passwords, or PII in this file.
decisions:
  - what: Using a work-stealing pattern in the poolMap function
    why: This allows for efficient parallel processing of items without blocking, maximizing resource utilization.
    tradeoff: The implementation complexity increases due to the need to manage concurrency and state.
constraints:
  - "The environment variable keys must follow the naming convention: /^[A-Za-z_][A-Za-z0-9_]*$/u."
  - The maximum concurrency value in poolMap must be at least 1 and not exceed the number of items being processed.
dependencies:
  internal:
    - ../core/fingerprint.js
    - ../core/scanner.js
    - ../core/schema.js
    - ../core/writer.js
    - ./config.js
exports:
  - "async function loadConfig(rootPath: string): Promise<ConfigFile | null>"
  - "async function saveConfig(rootPath: string, config: ConfigFile): Promise<void>"
  - "function resolveApiKey(config: ConfigFile): string | undefined"
  - "function getDefaultApiKeyEnv(provider: string): string"
  - "function freshnessIcon(state: FreshnessState): string"
  - "function successMsg(msg: string): string"
  - "function warnMsg(msg: string): string"
  - "function errorMsg(msg: string): string"
  - "function heading(msg: string): string"
  - "function dim(msg: string): string"
  - "function progressBar(current: number, total: number): string"
  - "async function loadEnvForCli(argv: string[]): Promise<void>"
  - "function resolvePathFromArgv(argv: string[]): string | undefined"
  - "async function loadEnvLocal(rootPath: string): Promise<void>"
  - "function parseEnvLine(line: string):"
  - "async function addToIgnore(rootPath: string, pathToIgnore: string): Promise<void>"
  - "async function poolMap<T, R>( items: T[], fn: (item: T) => Promise<R>, concurrency: number, ): Promise<R[]>"
  - "async function loadScanOptions(rootPath: string): Promise<ScanOptions>"
  - DEFAULT_MIN_TOKENS
  - "async function estimateDirectoryTokens(dir: ScanResult): Promise<number>"
  - "async function estimateContextFileTokens(dirPath: string): Promise<number>"
  - "function collectExtensions(dirs: ScanResult[]): Record<string, number>"
  - "async function filterByMinTokens( dirs: ScanResult[], minTokens?: number, ): Promise<"
derived_fields:
  - version
  - last_updated
  - fingerprint
  - scope
  - dependencies.internal
  - exports
